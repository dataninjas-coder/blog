<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Tuples in C# 7 - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tuples in C# 7</h1>
			
		</header><div class="content post__content clearfix">
			<p>A tuple is an finite ordered list of values, of possibly different types, which is used to bundle related values together without having to create a specific type to hold them.</p>
<p>In .NET 4.0, a set of <code>Tuple</code> classes has been introduced in the framework, which can be used as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Tuple&lt;<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">double</span>&gt; Tally(IEnumerable&lt;<span style="color:#66d9ef">double</span>&gt; values)
{
    <span style="color:#66d9ef">int</span> count = <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">double</span> sum = <span style="color:#ae81ff">0.0</span>;
    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> <span style="color:#66d9ef">value</span> <span style="color:#66d9ef">in</span> values)
    {
        count++;
        sum += <span style="color:#66d9ef">value</span>;
    }
    <span style="color:#66d9ef">return</span> Tuple.Create(count, sum);
}

...

<span style="color:#66d9ef">var</span> values = ...
<span style="color:#66d9ef">var</span> t = Tally(values);
Console.WriteLine(<span style="color:#e6db74">$&#34;There are {t.Item1} values and their sum is {t.Item2}&#34;</span>);
</code></pre></div><p>There are two annoying issues with the <code>Tuple</code> classes:</p>
<ul>
<li>They’re classes, i.e. reference types. This means they must be allocated on the heap, and garbage collected when they’re no longer used. For applications where performance is critical, it can be an issue. Also, the fact that they can be null is often not desirable.</li>
<li>The elements in the tuple don’t have names, or rather, they always have the same names (<code>Item1,</code> <code>Item2,</code> etc), which are not meaningful at all. The <code>Tuple&lt;T1, T2&gt;</code> type conveys no information about what the tuple actually represents, which makes it a poor choice in public APIs.</li>
</ul>
<p>In C# 7, a new feature will be introduced to improve support for tuples: you will be able to declare tuples types “inline”, a little like anonymous types, except that they’re not limited to the current method. Using this new feature, the code above becomes much cleaner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">static</span> (<span style="color:#66d9ef">int</span> count, <span style="color:#66d9ef">double</span> sum) Tally(IEnumerable&lt;<span style="color:#66d9ef">double</span>&gt; values)
{
    <span style="color:#66d9ef">int</span> count = <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">double</span> sum = <span style="color:#ae81ff">0.0</span>;
    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> <span style="color:#66d9ef">value</span> <span style="color:#66d9ef">in</span> values)
    {
        count++;
        sum += <span style="color:#66d9ef">value</span>;
    }
    <span style="color:#66d9ef">return</span> (count, sum);
}

...

<span style="color:#66d9ef">var</span> values = ...
<span style="color:#66d9ef">var</span> t = Tally(values);
Console.WriteLine(<span style="color:#e6db74">$&#34;There are {t.count} values and their sum is {t.sum}&#34;</span>);
</code></pre></div><p>Note how the return type of the <code>Tally</code> method is declared, and how the result is used. This is much better! The tuple elements now have significant names, and the syntax is nicer too. The feature relies on a new <code>ValueTuple&lt;T1, T2&gt;</code> structure, which means it doesn’t involve a heap allocation.</p>
<p>You can try this feature right now in Visual Studio 15 Preview 3. However, the  <code>ValueTuple&lt;T1, T2&gt;</code> type is not (yet) part of the .NET Framework; to get this example to work, you’ll need to reference the <a href="https://packages.nuget.org/packages/System.ValueTuple">System.ValueTuple</a> NuGet package.</p>
<p>Finally, one last remark about the names of tuple members: like many other language features, they’re just syntactic sugar. In the compiled code, the tuple members are only referred to as <code>Item1</code> and <code>Item2</code>, not <code>count</code> and <code>sum</code>. The <code>Tally</code> method above actually returns a <code>ValueTuple&lt;int, double&gt;</code>, not a specially generated type. Note that the compiler that ships with VS 15 Preview 3 emits no metadata about the names of the tuple members. This part of the feature is not yet implemented, but should be included in the final version. This means that in the meantime, you can’t use tuples across assemblies (well, you can, but you will lose the member names and will have to use <code>Item1</code> and <code>Item2</code> to refer to the tuple members).</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c/" rel="tag">C#</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c#-7/" rel="tag">C# 7</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/tuple/" rel="tag">tuple</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/visual-studio/" rel="tag">Visual Studio</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>