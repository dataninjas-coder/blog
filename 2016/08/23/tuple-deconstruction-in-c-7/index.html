<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Tuple deconstruction in C# 7 - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tuple deconstruction in C# 7</h1>
			
		</header><div class="content post__content clearfix">
			<p><a href="http://www.thomaslevesque.com/2016/07/25/tuples-in-c-7/">Last time</a> on this blog I talked about the new tuple feature of C# 7. In Visual Studio 15 Preview 3, the feature wasn’t quite finished; it lacked 2 important aspects:</p>
<ul>
<li>
<p>emitting metadata for the names of tuple elements, so that the names are preserved across assemblies</p>
</li>
<li>
<p>deconstruction of tuples into separate variables</p>
<p>Well, it looks like the C# language team has been busy during the last month, because both items are now implemented in VS 15 Preview 4, which was <a href="https://blogs.msdn.microsoft.com/visualstudio/2016/08/22/visual-studio-15-preview-4/">released today</a>! They’ve also written nice startup guides about <a href="https://github.com/dotnet/roslyn/blob/master/docs/features/tuples.md">tuples</a> and <a href="https://github.com/dotnet/roslyn/blob/master/docs/features/deconstruction.md">deconstruction</a>.  It is now possible to write something like this:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">var</span> values = ...
<span style="color:#66d9ef">var</span> (count, sum) = Tally(values);
Console.WriteLine(<span style="color:#e6db74">$&#34;There are {count} values and their sum is {sum}&#34;</span>);
</code></pre></div><p>(the <code>Tally</code> method is the one from the previous post)  Note that the intermediate variable <code>t</code> from the previous post has disappeared; we now assign the <code>count</code> and <code>sum</code> variables directly from the method result, which looks much nicer IMHO. There doesn’t seem to be a way to ignore part of the tuple (i.e. not assign it to a variable), hopefully it will come later.  An interesting aspect of deconstruction is that it’s not limited to tuples; any type can be deconstructed, as long as it has a <code>Deconstruct</code> method with the appropriate <code>out</code> parameters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Point</span>
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> X { <span style="color:#66d9ef">get</span>; }
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Y { <span style="color:#66d9ef">get</span>; }

    <span style="color:#66d9ef">public</span> Point(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y)
    {
        X = x;
        Y = y;
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Deconstruct(<span style="color:#66d9ef">out</span> <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">int</span> y)
    {
        x = X;
        y = Y;
    }
}

...

<span style="color:#66d9ef">var</span> (x, y) = point;
Console.WriteLine(<span style="color:#e6db74">$&#34;Coordinates: ({x}, {y})&#34;</span>);
</code></pre></div><p>The <code>Deconstruct</code> method can also be an extension method, which can be useful if you want to deconstruct a type that you don’t own. The old <code>System.Tuple</code> classes, for example, can be deconstructed using extension methods like this one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Deconstruct&lt;T1, T2&gt;(<span style="color:#66d9ef">this</span> Tuple&lt;T1, T2&gt; tuple, <span style="color:#66d9ef">out</span> T1 item1, <span style="color:#66d9ef">out</span> T2 item2)
{
    item1 = tuple.Item1;
    item2 = tuple.Item2;
}

...

<span style="color:#66d9ef">var</span> tuple = Tuple.Create(<span style="color:#e6db74">&#34;foo&#34;</span>, <span style="color:#ae81ff">42</span>);
<span style="color:#66d9ef">var</span> (name, <span style="color:#66d9ef">value</span>) = tuple;
Console.WriteLine(<span style="color:#e6db74">$&#34;Name: {name}, Value = {value}&#34;</span>);
</code></pre></div><p>Finally, methods that return tuples are now decorated with a <code>[TupleElementNames]</code> attribute that indicates the names of the tuple members:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#75715e">// Decompiled code
</span><span style="color:#75715e"></span><span style="color:#a6e22e">[return: TupleElementNames(new[]</span> { <span style="color:#e6db74">&#34;count&#34;</span>, <span style="color:#e6db74">&#34;sum&#34;</span> })]
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ValueTuple&lt;<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">double</span>&gt; Tally(IEnumerable&lt;<span style="color:#66d9ef">double</span>&gt; values)
{
   ...
}
</code></pre></div><p>(the attribute is emitted by the compiler, you don’t actually need to write it yourself)  This makes it possible to share the tuple member names across assemblies, and lets tools like Intellisense provide helpful information about the method.  So, the tuple feature of C# 7 seems to be mostly complete; however, keep in mind that it’s still a preview, and some things could change between now and the final release.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c/" rel="tag">C#</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c#-7/" rel="tag">C# 7</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/deconstruction/" rel="tag">deconstruction</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/tuple/" rel="tag">tuple</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/visual-studio-15/" rel="tag">Visual Studio 15</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>