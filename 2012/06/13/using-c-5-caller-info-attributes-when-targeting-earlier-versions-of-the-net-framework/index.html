<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Using C# 5 caller info attributes when targeting earlier versions of the .NET framework - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Using C# 5 caller info attributes when targeting earlier versions of the .NET framework</h1>
			
		</header><div class="content post__content clearfix">
			<p><a href="http://msdn.microsoft.com/en-us/library/hh534540%28v=vs.110%29.aspx">Caller info attributes</a> are one of the new features of C# 5. They&rsquo;re attributes applied to optional method parameters that enable you to pass caller information implicitly to a method. I&rsquo;m not sure that description is very clear, so an example will help you understand:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Log(
            <span style="color:#66d9ef">string</span> message,
<span style="color:#a6e22e">            [CallerMemberName]</span> <span style="color:#66d9ef">string</span> memberName = <span style="color:#66d9ef">null</span>,
<span style="color:#a6e22e">            [CallerFilePath]</span> <span style="color:#66d9ef">string</span> filePath = <span style="color:#66d9ef">null</span>,
<span style="color:#a6e22e">            [CallerLineNumber]</span> <span style="color:#66d9ef">int</span> lineNumber = <span style="color:#ae81ff">0</span>)
        {
            Console.WriteLine(
                <span style="color:#e6db74">&#34;[{0:g} - {1} - {2} - line {3}] {4}&#34;</span>,
                DateTime.UtcNow,
                memberName,
                filePath,
                lineNumber,
                message);
        }
</code></pre></div><p>The method above takes several parameters intended to pass information about the caller: calling member name, source file path and line number. The <code>Caller*</code> attributes make the compiler pass the appropriate values automatically, so you don&rsquo;t have to specify the values for these parameters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Foo()
        {
            Log(<span style="color:#e6db74">&#34;Hello world&#34;</span>);
            <span style="color:#75715e">// Equivalent to:
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// Log(&#34;Hello world&#34;, &#34;Foo&#34;, @&#34;C:\x\y\z\Program.cs&#34;, 18);
</span><span style="color:#75715e"></span>        }
</code></pre></div><p>This is of course especially useful for logging methods&hellip;  Notice that the <code>Caller*</code> attributes are defined in the .NET Framework 4.5. Now, suppose we use Visual Studio 2012 to target an earlier framework version (e.g. 4.0): the caller info attributes don&rsquo;t exist in 4.0, so we can&rsquo;t use them&hellip; But wait! What if we could trick the compiler into thinking the attributes exist? Let&rsquo;s define our own attributes, taking care to put them in the namespace where the compiler expects them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">namespace</span> System.Runtime.CompilerServices
{
<span style="color:#a6e22e">    [AttributeUsage(AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CallerMemberNameAttribute</span> : Attribute
    {
    }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">    [AttributeUsage(AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CallerFilePathAttribute</span> : Attribute
    {
    }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">    [AttributeUsage(AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CallerLineNumberAttribute</span> : Attribute
    {
    }
}
</code></pre></div><p>If we compile and run the program, we can see that our custom attributes are taken into account by the compiler. So they don&rsquo;t have to be defined in mscorlib.dll like the &ldquo;real&rdquo; ones, they just have to be in the right namespace, and the compiler accepts them. This enables us to use this cool feature when targeting .NET 4.0, 3.5 or even 2.0!  Note that a similar trick enabled the creation of extension methods when targeting .NET 2.0 with the C# 3 compiler: you just had to create an <code>ExtensionAttribute</code> class in the <code>System.Runtime.CompilerServices</code> namespace, and the compiler would pick it up. This is also what enabled <a href="http://www.albahari.com/nutshell/linqbridge.aspx">LinqBridge</a> to work.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c#-5/" rel="tag">c# 5</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/caller-info/" rel="tag">caller info</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>