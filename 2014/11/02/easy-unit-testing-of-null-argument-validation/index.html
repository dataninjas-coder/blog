<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Easy unit testing of null argument validation - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Easy unit testing of null argument validation</h1>
			
		</header><div class="content post__content clearfix">
			<p>When unit testing a method, one of the things to test is argument validation : for instance, ensure that the method throws a <code>ArgumentNullException</code> when a null argument is passed for a parameter that isn’t allowed to be null. Writing this kind of test is very easy, but it’s also a tedious and repetitive task, especially if the method has many parameters… So I wrote a method that automates part of this task: it tries to pass null for each of the specified arguments, and asserts that the method throws an <code>ArgumentNullException</code>. Here’s an example that tests a <code>FullOuterJoin</code> extension method:</p>
<pre><code>[Test]
public void FullOuterJoin_Throws_If_Argument_Null()
{
    var left = Enumerable.Empty&lt;int&gt;();
    var right = Enumerable.Empty&lt;int&gt;();
    TestHelper.AssertThrowsWhenArgumentNull(
        () =&gt; left.FullOuterJoin(right, x =&gt; x, y =&gt; y, (k, x, y) =&gt; 0, 0, 0, null),
        &quot;left&quot;, &quot;right&quot;, &quot;leftKeySelector&quot;, &quot;rightKeySelector&quot;, &quot;resultSelector&quot;);
}
</code></pre><p>The first parameter is a lambda expression that represents how to call the method. In this lambda, you should only pass valid arguments. The following parameters are the names of the parameters that are not allowed to be null. For each of the specified names, <code>AssertThrowsWhenArgumentNull</code> will replace the corresponding argument with null in the provided lambda, compile and invoke the lambda, and assert that the method throws a <code>ArgumentNullException</code>.</p>
<p>Using this method, instead of writing a test for each of the arguments that are not allowed to be null, you only need one test.</p>
<p>Here’s the code for the <code>TestHelper.AssertThrowsWhenArgumentNull</code> method (you can also find it on <a href="https://gist.github.com/thomaslevesque/c4cb9f537316b122f5b9">Gist</a>):</p>
<pre><code>using System;
using System.Linq;
using System.Linq.Expressions;
using NUnit.Framework;

namespace MyLibrary.Tests
{
    static class TestHelper
    {
        public static void AssertThrowsWhenArgumentNull(Expression&lt;TestDelegate&gt; expr, params string[] paramNames)
        {
            var realCall = expr.Body as MethodCallExpression;
            if (realCall == null)
                throw new ArgumentException(&quot;Expression body is not a method call&quot;, &quot;expr&quot;);

            var realArgs = realCall.Arguments;
            var paramIndexes = realCall.Method.GetParameters()
                .Select((p, i) =&gt; new { p, i })
                .ToDictionary(x =&gt; x.p.Name, x =&gt; x.i);
            var paramTypes = realCall.Method.GetParameters()
                .ToDictionary(p =&gt; p.Name, p =&gt; p.ParameterType);
            
            

            foreach (var paramName in paramNames)
            {
                var args = realArgs.ToArray();
                args[paramIndexes[paramName]] = Expression.Constant(null, paramTypes[paramName]);
                var call = Expression.Call(realCall.Method, args);
                var lambda = Expression.Lambda&lt;TestDelegate&gt;(call);
                var action = lambda.Compile();
                var ex = Assert.Throws&lt;ArgumentNullException&gt;(action, &quot;Expected ArgumentNullException for parameter '{0}', but none was thrown.&quot;, paramName);
                Assert.AreEqual(paramName, ex.ParamName);
            }
        }

    }
}
</code></pre><p>Note that it is written for NUnit, but can easily be adapted to other unit test frameworks.</p>
<p>I used this method in my <a href="https://github.com/thomaslevesque/Linq.Extras">Linq.Extras</a> library, which provides many additional extension methods for working with sequences and collections (including the <code>FullOuterJoin</code> method mentioned above).</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/argument-validation/" rel="tag">argument validation</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c/" rel="tag">C#</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/nunit/" rel="tag">nunit</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/unit-testing/" rel="tag">unit testing</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>