<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>[WPF] Declare global hotkeys in XAML with NHotkey - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[WPF] Declare global hotkeys in XAML with NHotkey</h1>
			
		</header><div class="content post__content clearfix">
			<p>A common requirement for desktop applications is to handle system-wide hotkeys, in order to intercept keyboard shortcuts even when they don’t have focus. Unfortunately, there is no built-in feature in the .NET framework to do it.</p>
<p>Of course, this is not a new issue, and there are quite a few open-source libraries that address it (e.g. <a href="https://github.com/SaqibS/VirtualInput">VirtualInput</a>). Most of them rely on a global system hook, which allow them to intercept <em>all</em> keystrokes, even the ones you’re not interested in. I used some of those libraries before, but I’m not really happy with them:</p>
<ul>
<li>they’re often tied to a specific UI framework (usually Windows Forms), which makes them a bit awkward to use in another UI framework (like WPF)</li>
<li>I don’t really like the approach of intercepting all keystrokes. It usually means that you end up with a big method with lots of <code>if/else if</code> to decide what to do based on which keys were pressed.</li>
</ul>
<p>A better option, in my opinion, is to listen only to the keys you’re interested in, and declare what to do for each of those. The approach used in WPF for key bindings is quite elegant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Window.InputBindings&gt;</span>
    <span style="color:#f92672">&lt;KeyBinding</span> <span style="color:#a6e22e">Gesture=</span><span style="color:#e6db74">&#34;Ctrl+Alt+Add&#34;</span> <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;{Binding IncrementCommand}&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;KeyBinding</span> <span style="color:#a6e22e">Gesture=</span><span style="color:#e6db74">&#34;Ctrl+Alt+Subtract&#34;</span> <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;{Binding DecrementCommand}&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/Window.InputBindings&gt;</span>
</code></pre></div><p>But of course, key bindings are not global, they require that your app has focus… What if we could change that?</p>
<p><a href="https://github.com/thomaslevesque/NHotkey">NHotkey</a> is a very simple hotkey library that enables global key bindings. All you have to do is set an attached property to true on your key bindings:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Window.InputBindings&gt;</span>
    <span style="color:#f92672">&lt;KeyBinding</span> <span style="color:#a6e22e">Gesture=</span><span style="color:#e6db74">&#34;Ctrl+Alt+Add&#34;</span> <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;{Binding IncrementCommand}&#34;</span>
                <span style="color:#a6e22e">HotkeyManager.RegisterGlobalHotkey=</span><span style="color:#e6db74">&#34;True&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;KeyBinding</span> <span style="color:#a6e22e">Gesture=</span><span style="color:#e6db74">&#34;Ctrl+Alt+Subtract&#34;</span> <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;{Binding DecrementCommand}&#34;</span>
                <span style="color:#a6e22e">HotkeyManager.RegisterGlobalHotkey=</span><span style="color:#e6db74">&#34;True&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/Window.InputBindings&gt;</span>
</code></pre></div><p>And that’s it; the commands defined in the key bindings will now be invoked even if your app doesn’t have focus!</p>
<p>You can also use NHotkey from code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">HotkeyManager.Current.AddOrReplace(<span style="color:#e6db74">&#34;Increment&#34;</span>, Key.Add, ModifierKeys.Control | ModifierKeys.Alt, OnIncrement);
HotkeyManager.Current.AddOrReplace(<span style="color:#e6db74">&#34;Decrement&#34;</span>, Key.Subtract, ModifierKeys.Control | ModifierKeys.Alt, OnDecrement);
</code></pre></div><p>The library takes advantage of the <code>RegisterHotkey</code> function. Because it also supports Windows Forms, it is split into 3 parts, so that you don’t need to reference the WinForms assembly from a WPF app or vice versa:</p>
<ul>
<li>The core library, which handles the hotkey registration itself, independently of any specific UI framework. This library is not directly usable, but is used by the other two.</li>
<li>The WinForms-specific API, which uses the <code>Keys</code> enumeration from <code>System.Windows.Forms</code></li>
<li>The WPF-specific API, which uses the <code>Key</code> and <code>ModifierKeys</code> enumerations from <code>System.Windows.Input</code>, and supports global key bindings in XAML.</li>
</ul>
<p>If you install the library from Nuget, add either the <a href="http://www.nuget.org/packages/NHotkey.Wpf/">NHotkey.Wpf</a> or the <a href="http://www.nuget.org/packages/NHotkey.WindowsForms/">NHotkey.WindowsForms</a> package; the core package will be added automatically.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/global/" rel="tag">global</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/hotkey/" rel="tag">hotkey</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/windows-forms/" rel="tag">windows forms</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/wpf/" rel="tag">WPF</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/xaml/" rel="tag">XAML</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>