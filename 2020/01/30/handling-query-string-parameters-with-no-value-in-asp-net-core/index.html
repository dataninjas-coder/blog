<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Handling query string parameters with no value in ASP.NET Core - Thomas Levesque&#39;s .NET Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-31621259-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Thomas Levesque&#39;s .NET Blog" rel="home">
				<div class="logo__title">Thomas Levesque&#39;s .NET Blog</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Handling query string parameters with no value in ASP.NET Core</h1>
			
		</header><div class="content post__content clearfix">
			<p>Query strings are typically made of a sequence of key-value pairs, like <code>?foo=hello&amp;bar=world…</code>. However, if you look at <a href="https://tools.ietf.org/html/rfc3986#section-3.4">RFC 3986</a>, you can see that query strings are very loosely specified. It mentions that</p>
<blockquote>
<p>query components are often used to carry identifying information in the form of &ldquo;key=value&rdquo; pairs</p>
</blockquote>
<p>But it&rsquo;s just an observation, not a rule (RFCs usually have very specific wording for rules, with words like MUST, SHOULD, etc.). So basically, a query string can be almost anything, it&rsquo;s not standardized. The use of key-value pairs separated by <code>&amp;</code> is just a convention, not a requirement.</p>
<p>And as it happens, it&rsquo;s not uncommon to see URLs with query strings like this: <code>?foo</code>, i.e. a key without a value. How it should be interpreted is entirely implementation-dependent, but in most cases, it probably means the same as <code>?foo=true</code>: the presence of the parameter is interpreted as an implicit true value.</p>
<p>Unfortunately, in ASP.NET Core MVC, there&rsquo;s no built-in support for this form of query string. If you have a controller action like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#a6e22e">[HttpGet(&#34;search&#34;)]</span>
<span style="color:#66d9ef">public</span> IActionResult Search(
<span style="color:#a6e22e">    [FromQuery]</span> <span style="color:#66d9ef">string</span> term,
<span style="color:#a6e22e">    [FromQuery]</span> <span style="color:#66d9ef">bool</span> ignoreCase)
{
    <span style="color:#960050;background-color:#1e0010">…</span>
}
</code></pre></div><p>The default <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1">model binder</a> expects the <code>ignoreCase</code> parameter to be specified with an explicit <code>true</code> or <code>false</code> value, e.g. <code>ignoreCase=true</code>. If you omit the value, it will be interpreted as empty, and the model binding will fail:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#e6db74">&#34;type&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://tools.ietf.org/html/rfc7231#section-6.5.1&#34;</span>,
  <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;One or more validation errors occurred.&#34;</span>,
  <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>,
  <span style="color:#e6db74">&#34;traceId&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;|53613c25-4767e032425dfb92.&#34;</span>,
  <span style="color:#e6db74">&#34;errors&#34;</span><span style="color:#f92672">:</span> {
    <span style="color:#e6db74">&#34;ignoreCase&#34;</span><span style="color:#f92672">:</span> [
      <span style="color:#e6db74">&#34;The value &#39;&#39; is invalid.&#34;</span>
    ]
  }
}
</code></pre></div><p>It&rsquo;s not a very big issue, but it&rsquo;s annoying… So, let&rsquo;s see what we can do about it!</p>
<p>By default, a boolean parameter is bound using <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.binders.simpletypemodelbinder?view=aspnetcore-3.1"><code>SimpleTypeModelBinder</code></a>, which is used for most primitive types. This model binder uses the <code>TypeConverter</code> of the target type to convert a string value to the target type. In this case, the converter is a <code>BooleanConverter</code>, which doesn&rsquo;t recognize an empty value…</p>
<p>So we need to create our own model binder, which will interpret the presence of a key with no value as an implicit <code>true</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BooleanModelBinder</span> : IModelBinder
{
    <span style="color:#66d9ef">public</span> Task BindModelAsync(ModelBindingContext bindingContext)
    {
        <span style="color:#66d9ef">var</span> result = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);
        <span style="color:#66d9ef">if</span> (result == ValueProviderResult.None)
        {
            <span style="color:#75715e">// Parameter is missing, interpret as false
</span><span style="color:#75715e"></span>            bindingContext.Result = ModelBindingResult.Success(<span style="color:#66d9ef">false</span>);
        }
        <span style="color:#66d9ef">else</span>
        {
            bindingContext.ModelState.SetModelValue(bindingContext.ModelName, result);
            <span style="color:#66d9ef">var</span> rawValue = result.FirstValue;
            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(rawValue))
            {
                <span style="color:#75715e">// Value is empty, interpret as true
</span><span style="color:#75715e"></span>                bindingContext.Result = ModelBindingResult.Success(<span style="color:#66d9ef">true</span>);
            }
            <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">bool</span>.TryParse(rawValue, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">var</span> boolValue))
            {
                <span style="color:#75715e">// Value is a valid boolean, use that value
</span><span style="color:#75715e"></span>                bindingContext.Result = ModelBindingResult.Success(boolValue);
            }
            <span style="color:#66d9ef">else</span>
            {
                <span style="color:#75715e">// Value is something else, fail
</span><span style="color:#75715e"></span>                bindingContext.ModelState.TryAddModelError(
                    bindingContext.ModelName,
                    <span style="color:#e6db74">&#34;Value must be false, true, or empty.&#34;</span>);
            }
        }

        <span style="color:#66d9ef">return</span> Task.CompletedTask;
    }
}
</code></pre></div><p>In order to use this model binder, we also need a model binder provider:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BooleanModelBinderProvider</span> : IModelBinderProvider
{
    <span style="color:#66d9ef">public</span> IModelBinder GetBinder(ModelBinderProviderContext context)
    {
        <span style="color:#66d9ef">if</span> (context.Metadata.ModelType == <span style="color:#66d9ef">typeof</span>(<span style="color:#66d9ef">bool</span>))
        {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BooleanModelBinder();
        }

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
    }
}
</code></pre></div><p>It will return our model binder if the target type is <code>bool</code>. Now we just need to add this provider to the list of model binder providers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#75715e">// In Startup.ConfigureServices
</span><span style="color:#75715e"></span>services.AddControllers(options =&gt;
{
    options.ModelBinderProviders.Insert(
        <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">new</span> BooleanModelBinderProvider());
});
</code></pre></div><p><em>Note: This code is for an ASP.NET Core 3 Web API project.</em></p>
<ul>
<li><em>If your project also has views or pages, replace <code>AddControllers</code> with <code>AddControllersWithViews</code> or <code>AddRazorPages</code>, as appropriate.</em></li>
<li><em>If you&rsquo;re using ASP.NET Core 2, replace <code>AddControllers</code> with <code>AddMvc</code>.</em></li>
</ul>
<p>Note that we need to insert our new model binder provider at the beginning of the list. If we add it at the end, another provider will match first, and our provider won&rsquo;t even be called.</p>
<p>And that&rsquo;s it: you should now be able to call your endpoint with a query string like <code>?term=foo&amp;ignoreCase</code>, without explicitly specifying <code>true</code> as the value of <code>ignoreCase</code>.</p>
<p>A possible improvement to this binder would be to also accept <code>0</code> or <code>1</code> as valid values for boolean parameters. I&rsquo;ll leave that as an exercise to you!</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/asp.net-core/" rel="tag">asp.net core</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/c/" rel="tag">C#</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/model-binding/" rel="tag">model binding</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/query-string/" rel="tag">query string</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>





			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Thomas Levesque&#39;s .NET Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>