<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Transform T4 templates as part of the build, and pass variables from the project | Thomas Levesque .NET Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.69.2" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.1cb140d8ba31d5b2f1114537dd04802a.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Transform T4 templates as part of the build, and pass variables from the project" />
<meta property="og:description" content="T4 (Text Template Transformation Toolkit) is a great tool to generate code at design time; you can, for instance, create POCO classes from database tables, generate repetitive code, etc. In Visual Studio, T4 files (.tt extension) are associated with the TextTemplatingFileGenerator custom tool, which transforms the template to generate an output file every time you save the template. But sometimes it&rsquo;s not enough, and you want to ensure that the template&rsquo;s output is regenerated before build." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog2.thomaslevesque.net/2017/11/13/transform-t4-templates-as-part-of-the-build-and-pass-variables-from-the-project/" />
<meta property="article:published_time" content="2017-11-12T22:05:47+00:00" />
<meta property="article:modified_time" content="2017-11-12T22:05:47+00:00" />
<meta itemprop="name" content="Transform T4 templates as part of the build, and pass variables from the project">
<meta itemprop="description" content="T4 (Text Template Transformation Toolkit) is a great tool to generate code at design time; you can, for instance, create POCO classes from database tables, generate repetitive code, etc. In Visual Studio, T4 files (.tt extension) are associated with the TextTemplatingFileGenerator custom tool, which transforms the template to generate an output file every time you save the template. But sometimes it&rsquo;s not enough, and you want to ensure that the template&rsquo;s output is regenerated before build.">
<meta itemprop="datePublished" content="2017-11-12T22:05:47&#43;00:00" />
<meta itemprop="dateModified" content="2017-11-12T22:05:47&#43;00:00" />
<meta itemprop="wordCount" content="709">



<meta itemprop="keywords" content="build,code generation,msbuild,T4,Visual Studio," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Transform T4 templates as part of the build, and pass variables from the project"/>
<meta name="twitter:description" content="T4 (Text Template Transformation Toolkit) is a great tool to generate code at design time; you can, for instance, create POCO classes from database tables, generate repetitive code, etc. In Visual Studio, T4 files (.tt extension) are associated with the TextTemplatingFileGenerator custom tool, which transforms the template to generate an output file every time you save the template. But sometimes it&rsquo;s not enough, and you want to ensure that the template&rsquo;s output is regenerated before build."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://blog2.thomaslevesque.net/" class="f3 fw2 hover-white no-underline white-90 dib">
      Thomas Levesque .NET Blog
    </a>
    <div class="flex-l items-center">
      

      
      














    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://blog2.thomaslevesque.net/2017/11/13/transform-t4-templates-as-part-of-the-build-and-pass-variables-from-the-project/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://blog2.thomaslevesque.net/2017/11/13/transform-t4-templates-as-part-of-the-build-and-pass-variables-from-the-project/&amp;text=Transform%20T4%20templates%20as%20part%20of%20the%20build,%20and%20pass%20variables%20from%20the%20project" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog2.thomaslevesque.net/2017/11/13/transform-t4-templates-as-part-of-the-build-and-pass-variables-from-the-project/&amp;title=Transform%20T4%20templates%20as%20part%20of%20the%20build,%20and%20pass%20variables%20from%20the%20project" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>

      <h1 class="f1 athelas mt3 mb1">Transform T4 templates as part of the build, and pass variables from the project</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2017-11-12T22:05:47Z">November 12, 2017</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><a href="https://docs.microsoft.com/en-us/visualstudio/modeling/code-generation-and-t4-text-templates">T4 (Text Template Transformation Toolkit)</a> is a great tool to generate code at design time; you can, for instance, create POCO classes from database tables, generate repetitive code, etc. In Visual Studio, T4 files (.tt extension) are associated with the <code>TextTemplatingFileGenerator</code> custom tool, which transforms the template to generate an output file every time you save the template. But sometimes it&rsquo;s not enough, and you want to ensure that the template&rsquo;s output is regenerated before build. It&rsquo;s pretty easy to set this up, but there are a few gotchas to be aware of.</p>
<h2 id="transforming-templates-at-build-time">Transforming templates at build time</h2>
<p>If your project is a classic csproj or vbproj (i.e. not a .NET Core SDK-style project), things are actually quite simple and well documented on <a href="https://docs.microsoft.com/en-us/visualstudio/modeling/code-generation-in-a-build-process">this page</a>.</p>
<p>Unload your project, and open it in the editor. Add the following <code>PropertyGroup</code> near the beginning of the file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">
    
    15.0
    $(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)
    
    true
    
    true
    
    false
</code></pre></div><p>And add the following <code>Import</code> at the end, after the import of <code>Microsoft.CSharp.targets</code> or <code>Microsoft.VisualBasic.targets</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">
</code></pre></div><p>Reload your project, and you&rsquo;re done. Building the project should now transform the templates and regenerate their output.</p>
<h2 id="sdk-style-projects">SDK-style projects</h2>
<p>If you&rsquo;re using the new project format that comes with the .NET Core SDK (sometimes informally called &ldquo;SDK-style project&rdquo;), the approach described above will need a small change to work. This is because the default targets file (<code>Sdk.targets</code> in the .NET Core SDK) is now imported implicitly at the very end of the project, so you can&rsquo;t import the text templating targets after the default targets. This causes the <code>BuildDependsOn</code> variable, which is modified by the T4 targets, to be overwritten, so the <code>TransformAll</code> target doesn&rsquo;t run before the <code>Build</code> target.</p>
<p>Fortunately, there&rsquo;s a workaround: you can import the default targets file explicitly, and import the text templating targets after that:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">
</code></pre></div><p>Note that it will cause a MSBuild warning in the build output (MSB4011) because <code>Sdk.targets</code> is imported twice; you can safely ignore this warning.</p>
<h2 id="passing-msbuild-variables-to-templates">Passing MSBuild variables to templates</h2>
<p>At some point, the code generation logic might become too complex to remain entirely in the T4 template file. You might want to extract some of it into a helper assembly, and reference this assembly from the template, like this:</p>
<pre><code>&lt;#@ assembly name=&quot;../CodeGenHelper/bin/Release/net462/CodeGenHelper.dll&quot; #&gt;
</code></pre><p>Of course, specifying the path like this isn&rsquo;t very very convenient&hellip; For instance, if you&rsquo;re currently in <code>Debug</code> configuration, the <code>Release</code> version of CodeGenHelper.dll might be out of date. Fortunately, Visual Studio&rsquo;s <code>TextTemplatingFileGenerator</code> custom tool recognizes MSBuild variables from the project, so you can do this instead:</p>
<pre><code>&lt;#@ assembly name=&quot;$(SolutionDir)/CodeGenHelper/bin/$(Configuration)/net462/CodeGenHelper.dll&quot; #&gt;
</code></pre><p>The <code>$(SolutionDir)</code> and <code>$(Configuration)</code> variables will be expanded to their actual values. If you save the template, the template will be transformed using the CodeGenHelper.dll assembly. Nice!</p>
<p>However, there&rsquo;s a catch&hellip; if you configured the project to transform templates on build as described above, the build will now fail, with an error like this:</p>
<blockquote>
<p>System.IO.FileNotFoundException: Could not find a part of the path &lsquo;C:\Path\To\The\Project$(SolutionDir)\CodeGenHelper\bin$(Configuration)\net462\CodeGenHelper.dll&rsquo;.</p>
</blockquote>
<p>Notice the <code>$(SolutionDir)</code> and <code>$(Configuration)</code> variables in the path? They were not expanded! This is because the MSBuild target that transforms the templates and the <code>TextTemplatingFileGenerator</code> custom tool don&rsquo;t use the same text transformation engine. And unfortunately, the one used by MSBuild doesn&rsquo;t recognize MSBuild properties out of the box&hellip; Ironic, isn&rsquo;t it?</p>
<p>All is not lost, though. All you have to do is explicitly specify the variables you want to pass as T4 parameters. Edit your project file again, and create a new <code>ItemGroup</code> with the following items:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">
    
        $(SolutionDir)
        False
    
    
        $(Configuration)
        False
    
</code></pre></div><p>The <code>Include</code> attribute is the name of the parameter as it will be passed to the text transformation engine. The <code>Value</code> element is, well, the value. And the <code>Visible</code> element prevents the <code>T4ParameterValues</code> item from appearing under the project in the solution explorer.</p>
<p>With this change, the build should now successfully transform the templates again.</p>
<p>So, just keep in mind that the <code>TextTemplatingFileGenerator</code> custom tool and the MSBuild text transformation target have different mechanisms for passing variables:</p>
<ul>
<li><code>TextTemplatingFileGenerator</code> supports <em>only</em> MSBuild variables from the project</li>
<li>MSBuild supports <em>only</em> <code>T4ParameterValues</code></li>
</ul>
<p>So if you use variables in your template and you want to be able to transform it when you save the template in Visual Studio <em>and</em> when you build the project, the variables have to be defined both as MSBuild variables and as <code>T4ParameterValues</code>.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/build" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">build</a>
   </li>
  
   <li class="list">
     <a href="/tags/code-generation" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">code generation</a>
   </li>
  
   <li class="list">
     <a href="/tags/msbuild" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">msbuild</a>
   </li>
  
   <li class="list">
     <a href="/tags/t4" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">T4</a>
   </li>
  
   <li class="list">
     <a href="/tags/visual-studio" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Visual Studio</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2017/09/18/common-msbuild-properties-and-items-with-directory-build-props/">Common MSBuild properties and items with Directory.Build.props</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2013/11/14/running-a-custom-tool-automatically-when-a-file-is-modified/">Running a custom tool automatically when a file is modified</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2017/08/26/testing-and-debugging-library-code-from-linqpad/">Testing and debugging library code from LINQPad</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2016/07/25/tuples-in-c-7/">Tuples in C# 7</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2016/04/16/test-driving-c-7-features-in-visual-studio-15-preview/">Test driving C# 7 features in Visual Studio “15” Preview</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2014/10/12/visual-studio-online-git-integration-with-team-explorer/">Visual Studio Online &#43; Git integration with Team Explorer</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2009/10/26/vs2010-binding-support-in-inputbindings/">[VS2010] Binding support in InputBindings</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2009/03/05/visual-studio-trick-make-a-project-item-a-child-item-of-another/">[Visual Studio] Trick : make a project item a child item of another</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://blog2.thomaslevesque.net/" >
    &copy;  Thomas Levesque .NET Blog 2020 
  </a>
    <div>













</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
